function [T,T_whole,ke]=finite_element_beam(L,E,I,A,fai,T,T_whole,Joint,i,rtheta,kv,kh)
% if ismember(i,Joint(1,:))
%     r1=1;
%     r2=rtheta;
% else if ismember(i,Joint(2,:))
%         r1=rtheta;
%         r2=1;
%     else 
        r1=1;
        r2=1;
%     end
% end
M22=(4*r2-2*r1+r1*r2)/(4-r1*r2);
M23=(-2*L*r1*(1-r2))/(4-r1*r2);
M32=6*(r1-r2)/L/(4-r1*r2);
M33=3*r1*(2-r2)/(4-r1*r2);
M55=(4*r1-2*r2+r1*r2)/(4-r1*r2);
M56=2*L*r2*(1-r1)/(4-r1*r2);
M65=6*(r1-r2)/L/(4-r1*r2);
M66=3*r2*(2-r1)/(4-r1*r2);
MODI=[1,0,0,0,0,0;...
    0,M22,M23,0,0,0;...
    0,M32,M33,0,0,0;...
    0,0,0,1,0,0;...
    0,0,0,0,M55,M56;...
    0,0,0,0,M65,M66];  
    
    
ke_local_continus=[A/L,0,0,-A/L,0,0;...
    0,12*I/L^3,6*I/L^2,0,-12*I/L^3,6*I/L^2;...
    0,6*I/L^2,4*I/L,0,-6*I/L^2,2*I/L;...
    -A/L,0,0,A/L,0,0;...
    0,-12*I/L^3,-6*I/L^2,0,12*I/L^3,-6*I/L^2;...
    0,6*I/L^2,2*I/L,0,-6*I/L^2,4*I/L]*E;

ke_beam_local=ke_local_continus*MODI;


k_foundation=kv;
ke_foundation_local=k_foundation*[0,0,0,0,0,0;...
                         0,156,22*L,0,54,-13*L;...
                         0,22*L,4*L^2,0,13*L,-3*L^2;...
                         0,0,0,0,0,0;...
                         0,54,13*L,0,156,-22*L;...
                         0,-13*L,-3*L^2,0,-22*L,4*L^2]*L/420;

ke_local=ke_beam_local+ke_foundation_local;
T_e=[cos(fai),-sin(fai),0;...
     sin(fai),cos(fai),0;...
     0,0,1];
 
T_T=blkdiag(T_e,T_e);
ke=T_T*ke_local*T_T';
T=blkdiag(T,T_e);
T_whole=blkdiag(T_whole,T_T);
end